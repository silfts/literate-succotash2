<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Безопасность GraphQL API</title>
  <style>
    :root {
      --bg-color: #1e1e1e;
      --text-color: #e0e0e0;
      --heading-color: #4fd1c5;
      --code-bg: #2d2d2d;
      --code-text: #ffffff;
      --accent: #00bcd4;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: "Segoe UI", sans-serif;
      line-height: 1.6;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
    }

    h1, h2, h3 {
      color: var(--heading-color);
    }

    img {
      display: block;
      margin: 15px auto;
      max-width: 100%;
      height: auto;
      border: 1px solid #555;
      border-radius: 6px;
    }

    code {
      background-color: var(--code-bg);
      color: var(--code-text);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: Consolas, monospace;
    }

    pre {
      background-color: var(--code-bg);
      color: var(--code-text);
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: Consolas, monospace;
      font-size: 15px;
      margin: 20px 0;
    }

    ul {
      padding-left: 20px;
    }

    a {
      color: var(--accent);
    }

    blockquote {
      border-left: 4px solid #4fd1c5;
      padding-left: 15px;
      margin: 1em 0;
      color: #ccc;
    }
  </style>
</head>
<body>

  <h1>GraphQL – это язык запроса API</h1>
  <p>
    GraphQL – это язык запроса API, который позволяет клиентам гибко запрашивать только нужные данные...
  </p>

  <h2>Архитектура GraphQL и отличие от REST</h2>
  <p>
    GraphQL и REST – два варианта построения API, но они различаются принципами работы.
  </p>
  <img src="img/graphql-vs-rest.png" alt="GraphQL vs REST">

  <p>
    REST строится на множестве эндпоинтов... <i>(оставшийся текст)</i>
  </p>

  <h2>Основная концепция GraphQL</h2>
  <p>Схема, типы, запросы, мутации, подписки...</p>

  <pre><code>type Author {
  id: ID!
  name: String!
  books: [Book]
}

type Book {
  id: ID!
  title: String!
  author: Author
}</code></pre>

  <h2>Основные уязвимости в GraphQL</h2>

  <h3>Инспекция схемы (Introspection Attack)</h3>
  <pre><code>{
  __schema {
    types {
      name
      fields {
        name
      }
    }
  }
}</code></pre>

  <h3>GraphQL-инъекции</h3>
  <pre><code>{
  user(id: "1 OR 1=1") {
    username
  }
}</code></pre>

  <h3>DDoS-атаки через сложный запрос</h3>
  <pre><code>{
  user {
    friends {
      friends {
        friends {
          username
        }
      }
    }
  }
}</code></pre>

  <h2>Методы и способы защиты GraphQL API</h2>
  <ul>
    <li>Отключить introspection</li>
    <li>Проверка входных данных</li>
    <li>Ограничение глубины запроса</li>
    <li>Rate limiting</li>
    <li>HTTPS</li>
    <li>Аутентификация и авторизация</li>
  </ul>

  <h3>Пример: ограничение глубины</h3>
  <pre><code>const express = require('express');
const { graphqlHTTP } = require('express-graphql');
const { makeExecutableSchema } = require('@graphql-tools/schema');
const depthLimit = require('graphql-depth-limit');

const typeDefs = `
  type Query {
    hello: String
  }
`;

const resolvers = {
  Query: {
    hello: () => 'Hello world!',
  },
};

const schema = makeExecutableSchema({ typeDefs, resolvers });

const app = express();

app.use(
  '/graphql',
  graphqlHTTP({
    schema: schema,
    validationRules: [depthLimit(5)],
  })
);

app.listen(4000, () => {
  console.log('Server is running on http://localhost:4000/graphql');
});</code></pre>

  <h2>Инструменты для тестирования безопасности GraphQL</h2>

  <h3>GraphQLmap</h3>
  <p>GraphQLmap – автоматизированный инструмент для тестирования GraphQL API на уязвимости.</p>
  <img src="img/graphqlmap.png" alt="GraphQLmap интерфейс">

  <h3>GraphQL Voyager</h3>
  <p>GraphQL Voyager – инструмент для визуализации API схем и поиска уязвимостей.</p>
  <img src="img/graphql-voyager.png" alt="GraphQL Voyager пример">

  <h3>InQL (Burp Suite Plugin)</h3>
  <p>InQL (Burp Suite Plugin) – расширение Burp Suite для анализа GraphQL API и обнаружения скрытых эндпоинтов.</p>
  <img src="img/inql-burp.png" alt="InQL для Burp Suite">

  <h2>Заключение</h2>
  <p>
    GraphQL — гибкий инструмент для построения API, но требует строгих мер безопасности. Используй ограничения, валидацию, аутентификацию и тестовые инструменты, чтобы предотвратить возможные уязвимости.
  </p>

</body>
</html>
